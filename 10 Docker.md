[초보를 위한 도커 안내서 - 도커란 무엇인가?](https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html) 정리본

# Docker

## 서버를 관리한다는 것

서버는 최대한 건드리지 않고 그대로 두는게 좋음

회사에서 사용하는 (리눅스, 오라클 등) 버전은 정해져 있기 때문에 버전을 업데이트 하는 건 엄청난 리스크



서버 관리의 어려움

- 리눅스 배포판이 바뀌거나 환경이 달라지는 경우
- 하나의 서버에 여러 개의 프로그램을 설치하는 경우
  - 서로 사용하는 라이브러리의 버전이 다른 경우
  - 동일한 포트를 사용하는 경우
  - 서로 다른 서버에 설치하면 조립 PC가 늘어나 자원 낭비
- 시간이 흐르면서 서버 환경이 계속 바뀜
  - 예: CentOS -> Ubuntu, AWS -> Azure, Chef의 cookbook -> Ansible의 playbook
  - DevOps의 등장
    - 개발 주기가 짧아지면서 배포가 더 자주 이루어짐
  - 마이크로서비스 아키텍쳐의 유행
    - 프로그램을 더 잘게 쪼개어 관리



새로운 툴은 계속해서 나오고, 클라우드의 발전으로 설치해야 할 서버가 엄청나게 많아짐

- *도커(Docker)의 등장으로 서버관리 방식이 완전히 바뀌게 됨*



## 도커의 역사

2003년 3월

- 산타클라라에서 열린 Pycon Conference에서 dotCloud의 창업자 Solomon Hykes가 The future of Linux Containers 라는 세션을 발표

2013년 10월

- 회사 이름을 Docker Inc.로 바꿈

2014년 6월

- 도커 1.0 발표

2014년 8월

- 도커에 집중하기 위해 dotCloud 플랫폼을 매각

2015년 4월

- 약 1,100억원의 투자 유치



2016년 한 설문조사에 따르면,

- 90%가 개발에 사용 중
- 80%가 DevOps에 사용할 예정
- 58%가 운영환경에서 사용 중



## 도커란?

컨테이너 기반의 오픈소스 가상화 플랫폼

완전히 새로운 기술이 아니며, 이미 존재하는 기술을 잘 포장한 것





컨테이너

- 배에 실는 네모난 화물 수송용 박스
- 각각의 컨테이너 안에 옷, 신발, 전자제품, 술, 과일 등 다양한 화물을 넣을 수 있음
- 규격화되어 선이나 트레일러 등 다양한 운송수단으로 쉽게 옮길 수 있음

서버에서 컨테이너

- 다양한 프로그램, 실행환경을 컨테이너로 추상화
  - 프로그램: 백엔드 프로그램, 데이터베이스 서버, 메시지 큐, 등
  - 실행환경: 조립 PC, AWS, Azure, Google Cloud, 등
- 동일한 인터페이스를 제공하여 프로그램의 배포 및 관리를 단순하게 해줌
- (컨테이너를 가장 잘 사용하고 있는 기업인) 구글의 경우, 모든 서비스들이 컨테이너로 동작하고 매주 20억 개의 컨테이너를 구동 (2014년 발표)



### 컨테이너(Container)

격리된 공간에서 프로세스가 동작하는 기술

가상화 기술의 하나

도커가 처음 만든 것은 아님

- 리눅스의 LXC(Linux container): cgroups(control groups)와 namespace를 이용
  - 도커는 LXC를 기반으로 시작
- FreeBSD의 Jail
- Solaris의 Solaris Zones
- 구글의 Imctfy(Let Me Contain That For You): 직접 오픈소스 컨테이너 기술 개발 (성공하지는 못했음)

이미지를 실행한 상태

추가되거나 변하는 값은 컨테이너에 저장됨



가상머신(VM)

- OS를 가상화 (기존 가상화 방식)
- 호스트 OS 위에 게스트 OS 전체를 가상화하여 사용
- (리눅스에서 윈도우를 돌리는 등) 여러가지 OS를 가상화할 수 있고, 비교적 사용법이 간단함
- 무겁고 느려서 운영환경에선 사용할 수 없음
- 이를 개선하기 위해 KVM과 Xen 등장
  - KVM: Kernel-based Virtual Machine, CPU의 가상화 기술(HVM)을 이용
  - Xen: 반가상화(Paravirtualization) 방식
  - 게스트 OS가 필요하긴 하지만, 전체 OS를 가상화하는 방식이 아니였기 때문에 호스트형 가상화 방식에 비해 성능 향상
  - OpenStack이나 AWS, Rackspace 같은 클라우드 서비스에서 가상 컴퓨팅 기술의 기반

도커(Docker)

- 추가적인 OS를 설치하여 가상화하는 방법(전가상화, 반가상화)은 성능 문제가 있음
- 이를 개선하기 위해 프로세스를 격리하는 방식 등장

  - 리눅스에서는 리눅스 컨테이너라고 함

  - 단순히 프로세스를 격리시키기 때문에 가볍고 빠르게 동작
- CPU나 메모리는 딱 프로세스가 필요한 만큼만 추가로 사용하기 때문에 성능 손실이 거의 없음
- 하나의 서버에 여러 개의 컨테이너를 실행하면 서로 영향을 미치지 않고 독립적으로 실행되어 가벼운 VM을 사용하는 느낌을 줌
- 실행 중인 컨테이너에 접속

  - 명령어 입력
  - 패키지 설치 (`apt-get`이나 `yum`으로)
  - 사용자 추가
  - 여러 개의 프로세스를 백그라운드로 실행
  - CPU나 메모리 사용량 제한
  - 호스트의 특정 포트와 연결하거나 호스트의 특정 디렉토리를 내부 디렉토리인 것처럼 사용
- 새로운 컨테이너를 만드는 데 걸리는 시간은 1~2초로, 가상머신과 비교도 할 수 없이 빠름
- 0.9 버전에서 자체적인 libcontainer 기술을 사용, 추후 runC 기술에 합쳐짐



### 이미지(Image)

컨테이너 실행에 필요한 파일과 설정값 등을 포함하고 있는 것

상태값을 가지지 않고 변하지 않음(immutable)

같은 이미지에서 여러 개의 컨테이너를 생성할 수 있음

- 한 서버든 수천 대의 서버든 컨테이너를 실행하는데 문제 없음

컨테이너의 상태가 바뀌거나 컨테이너가 삭제되어도 이미지는 변하지 않고 그대로 남아있음

컨테이너를 실행하기 위한 모든 정보를 갖고 있음

- ubuntu 이미지는 ubuntu를 실행하기 위한 모든 파일을 갖고 있음

- MySQL 이미지는 debian 기반으로 MySQL을 실행하는데 필요한 파일과 실행 명령어, 포트 정보 등을 갖고 있음

- Gitlab 이미지는 centos 기반으로 ruby, go, database, redis, gitlab source, nginx 등을 갖고 있음
- 더이상 의존성 파일을 컴파일하고 이것저것 설치가 필요 없음
- 새로운 서버가 추가되면 미리 만들어 놓은 이미지를 다운받고 컨테이너를 생성하기만 하면 됨



도커 이미지

- Docker hub에 등록하거나 Docker Registry 저장소를 직접 만들어 관리할 수 있음
- 누구나 쉽게 이미지를 만들고 배포할 수 있음



## 레이어 저장방식

## 이미지 경로

## Dockerfile

## Docker Hub

## Command와 API

## 유용한 새로운 기능들

## 훌륭한 생태계

## 커뮤니티 지원

## moby dock

## 정리